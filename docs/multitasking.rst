Mutlitasking Implementation
============================
The code for our project runs using a priority-based cooperative multitasking structure. We used the open source cotask.py to create tasks and run them in a task scheduler. Each task references a generator function in our main.pyb file that is loaded onto the MCU. In general, each task is implemented as a finite state machine, although some of our tasks align with this structure more closely than others.

Inter-task communication
-------------------------
Information is communicated between tasks using Share and Queue objects from the open source taskshare.py. A Queue is made of a series of Shares. Shares are defined as a certain data type, and information of that data type is stored in the share object and can be referenced in other tasks. Below is a tabulated version of all of the shares we used. In general, we used uint16 shares for true/false flags and data that would only count in positive whole numbers (such as encoder counts). For other shares where decimal values were needed or desired, float was used.

List of shares
~~~~~~~~~~~~~~
+----------------------+-----------+-----------+------------+---------------------------------------------------------------+
| Variable Name        | Type Code | Type Desc | Size (bits)| Description                                                   |
+======================+===========+===========+============+===============================================================+
| L_lin_spd            | f         | float     | 32         | Left motor linear speed setpoint (mm/s)                      |
+----------------------+-----------+-----------+------------+---------------------------------------------------------------+
| L_voltage_share      | f         | float     | 32         | Left motor effective voltage (V)                             |
+----------------------+-----------+-----------+------------+---------------------------------------------------------------+
| L_en_share           | H         | uint16    | 16         | Left encoder count                                           |
+----------------------+-----------+-----------+------------+---------------------------------------------------------------+
| L_pos_share          | f         | float     | 32         | Left wheel position (encoder counts)                         |
+----------------------+-----------+-----------+------------+---------------------------------------------------------------+
| L_vel_share          | f         | float     | 32         | Left wheel velocity (counts/s)                               |
+----------------------+-----------+-----------+------------+---------------------------------------------------------------+
| L_time_share         | H         | uint16    | 16         | Timestamp (µs)                                                |
+----------------------+-----------+-----------+------------+---------------------------------------------------------------+
| R_dir_share          | H         | uint16    | 16         | Right motor direction                                         |
+----------------------+-----------+-----------+------------+---------------------------------------------------------------+
| R_lin_spd            | f         | float     | 32         | Right motor linear speed setpoint (mm/s)                     |
+----------------------+-----------+-----------+------------+---------------------------------------------------------------+
| R_voltage_share      | f         | float     | 32         | Right motor effective voltage (V)                            |
+----------------------+-----------+-----------+------------+---------------------------------------------------------------+
| R_en_share           | H         | uint16    | 16         | Right encoder count                                          |
+----------------------+-----------+-----------+------------+---------------------------------------------------------------+
| R_pos_share          | f         | float     | 32         | Right wheel position (encoder counts)                        |
+----------------------+-----------+-----------+------------+---------------------------------------------------------------+
| R_vel_share          | f         | float     | 32         | Right wheel velocity (counts/s)                              |
+----------------------+-----------+-----------+------------+---------------------------------------------------------------+
| R_time_share         | H         | uint16    | 16         | Timestamp (µs)                                                |
+----------------------+-----------+-----------+------------+---------------------------------------------------------------+
| run                  | H         | uint16    | 16         | Global run flag                                               |
+----------------------+-----------+-----------+------------+---------------------------------------------------------------+
| print_out            | H         | uint16    | 16         | Debug print flag                                              |
+----------------------+-----------+-----------+------------+---------------------------------------------------------------+
| bat_share            | f         | float     | 32         | Battery voltage                                               |
+----------------------+-----------+-----------+------------+---------------------------------------------------------------+
| bat_flag             | H         | uint16    | 16         | Low-battery boolean flag                                      |
+----------------------+-----------+-----------+------------+---------------------------------------------------------------+
| calib_black          | H         | uint16    | 16         | Black calibration value                                       |
+----------------------+-----------+-----------+------------+---------------------------------------------------------------+
| calib_white          | H         | uint16    | 16         | White calibration value                                       |
+----------------------+-----------+-----------+------------+---------------------------------------------------------------+
| line_follow          | H         | uint16    | 16         | Boolean enabling line follower controller                    |
+----------------------+-----------+-----------+------------+---------------------------------------------------------------+
| position_follow      | H         | uint16    | 16         | Boolean enabling position follower controller                |
+----------------------+-----------+-----------+------------+---------------------------------------------------------------+
| wheel_diff           | f         | float     | 32         | Wheel speed difference compensation                           |
+----------------------+-----------+-----------+------------+---------------------------------------------------------------+
| yaw_angle_share      | f         | float     | 32         | IMU yaw angle                                                 |
+----------------------+-----------+-----------+------------+---------------------------------------------------------------+
| yaw_rate_share       | f         | float     | 32         | IMU yaw rate                                                  |
+----------------------+-----------+-----------+------------+---------------------------------------------------------------+
| dist_traveled_share  | f         | float     | 32         | Integrated forward distance                                   |
+----------------------+-----------+-----------+------------+---------------------------------------------------------------+
| IMU_time_share       | H         | uint16    | 16         | IMU timestamp (µs)                                            |
+----------------------+-----------+-----------+------------+---------------------------------------------------------------+
| time_start_share     | H         | uint16    | 16         | Time start for a motion segment                               |
+----------------------+-----------+-----------+------------+---------------------------------------------------------------+
| X_coords_share       | f         | float     | 32         | Current global X position                                     |
+----------------------+-----------+-----------+------------+---------------------------------------------------------------+
| Y_coords_share       | f         | float     | 32         | Current global Y position                                     |
+----------------------+-----------+-----------+------------+---------------------------------------------------------------+
| start_pathing        | H         | uint16    | 16         | Boolean flag to start pathing commands                       |
+----------------------+-----------+-----------+------------+---------------------------------------------------------------+
| X_target             | f         | float     | 32         | Desired X coordinate                                          |
+----------------------+-----------+-----------+------------+---------------------------------------------------------------+
| Y_target             | f         | float     | 32         | Desired Y coordinate                                          |
+----------------------+-----------+-----------+------------+---------------------------------------------------------------+
| dist_from_target     | f         | float     | 32         | Distance error to target                                      |
+----------------------+-----------+-----------+------------+---------------------------------------------------------------+



Task Diagram
-------------

List of Tasks
--------------
+-------------------------+-----------------------+----------+----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Task Name               | Generator function name  | Priority | Period   | Shares Used                                                                                                                                                                                                                                                         |
+=========================+=======================+==========+==========+=====================================================================================================================================================================================================================================================================+
| Left ops                | left_ops()            | 3        | 20 ms    | L_lin_spd, L_en_share, L_pos_share, L_vel_share, L_time_share, wheel_diff, line_follow, L_voltage_share, position_follow                                                                                                                                            |
+-------------------------+-----------------------+----------+----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Right ops               | right_ops()           | 4        | 20 ms    | R_lin_spd, R_en_share, R_pos_share, R_vel_share, R_time_share, wheel_diff, line_follow, R_voltage_share, position_follow                                                                                                                                            |
+-------------------------+-----------------------+----------+----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| UI                      | run_UI()              | 1        | 100 ms   | L_lin_spd, R_lin_spd, run, print_out, time_start_share, start_pathing                                                                                                                                                                                               |
+-------------------------+-----------------------+----------+----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Battery                 | battery_read()        | 0        | 2000 ms  | bat_share, bat_flag                                                                                                                                                                                                                                                  |
+-------------------------+-----------------------+----------+----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| IR sensor               | IR_sensor()           | 0        | 50 ms    | calib_black, calib_white, line_follow, L_lin_spd, R_lin_spd, wheel_diff                                                                                                                                                                                             |
+-------------------------+-----------------------+----------+----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| state estimator         | IMU_OP()              | 10       | 50 ms    | L_pos_share, R_pos_share, L_voltage_share, R_voltage_share, L_vel_share, R_vel_share, yaw_angle_share, yaw_rate_share, dist_traveled_share, IMU_time_share, time_start_share, X_coords_share, Y_coords_share                                                       |
+-------------------------+-----------------------+----------+----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Commander               | commander()           | 0        | 20 ms    | X_coords_share, Y_coords_share, start_pathing, position_follow, line_follow, X_target, Y_target, dist_from_target, dist_traveled_share, R_lin_spd, L_lin_spd                                                                                                       |
+-------------------------+-----------------------+----------+----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Pos CTRL                | PositionControl()     | 0        | 20 ms    | X_coords_share, Y_coords_share, position_follow, IMU_time_share, yaw_angle_share, wheel_diff, dist_from_target, X_target, Y_target                                                                                                                                  |
+-------------------------+-----------------------+----------+----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+


Task Descriptions
------------------

FSM and short blurb for each task

commander
~~~~~~~~~~



